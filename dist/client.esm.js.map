{"version":3,"file":"client.esm.js","sources":["../src/shared.js","../src/client.js"],"sourcesContent":["export function encodeMessage(event, data) {\r\n  return JSON.stringify({ event, data });\r\n}\r\n\r\nexport function decodeMessage(msg) {\r\n  try {\r\n    return JSON.parse(msg);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n","import { encodeMessage, decodeMessage } from './shared.js';\r\n\r\nexport function createClient(url, options = {}) {\r\n  const {\r\n    reconnect = true,\r\n    reconnectInterval = 2000,\r\n    maxRetries = 10,\r\n    debug = false,\r\n  } = options;\r\n\r\n  let socket;\r\n  const listeners = {};\r\n  let isConnected = false;\r\n  let retryCount = 0;\r\n\r\n  function log(...args) {\r\n    if (debug) console.log('[WebSocketClient]', ...args);\r\n  }\r\n\r\n  function connect() {\r\n    socket = new WebSocket(url);\r\n\r\n    socket.onopen = () => {\r\n      isConnected = true;\r\n      retryCount = 0;\r\n      log('Connected');\r\n      if (listeners['connect']) listeners['connect'].forEach(fn => fn());\r\n    };\r\n\r\n    socket.onmessage = (e) => {\r\n      const msg = decodeMessage(e.data);\r\n      if (msg && listeners[msg.event]) {\r\n        listeners[msg.event].forEach(fn => fn(msg.data));\r\n      }\r\n    };\r\n\r\n    socket.onerror = (err) => {\r\n      if (listeners['error']) listeners['error'].forEach(fn => fn(err));\r\n    };\r\n\r\n    socket.onclose = () => {\r\n      isConnected = false;\r\n      log('Disconnected');\r\n      if (listeners['disconnect']) listeners['disconnect'].forEach(fn => fn());\r\n      if (reconnect && retryCount < maxRetries) {\r\n        retryCount++;\r\n        setTimeout(() => connect(), reconnectInterval * retryCount);\r\n      }\r\n    };\r\n  }\r\n\r\n  connect();\r\n\r\n  return {\r\n    emit(event, data) {\r\n      if (isConnected) socket.send(encodeMessage(event, data));\r\n    },\r\n\r\n    emitWithAck(event, data, timeout = 2000) {\r\n      return new Promise((resolve, reject) => {\r\n        const id = Date.now().toString();\r\n        const ackEvent = `${event}_ack_${id}`;\r\n\r\n        const handler = (res) => {\r\n          resolve(res);\r\n          this.off(ackEvent);\r\n        };\r\n\r\n        this.on(ackEvent, handler);\r\n        this.emit(event, { ...data, _ackId: id });\r\n\r\n        setTimeout(() => {\r\n          this.off(ackEvent);\r\n          reject('Timeout');\r\n        }, timeout);\r\n      });\r\n    },\r\n\r\n    on(event, handler) {\r\n      if (!listeners[event]) listeners[event] = [];\r\n      listeners[event].push(handler);\r\n    },\r\n\r\n    once(event, handler) {\r\n      const wrapper = (data) => {\r\n        handler(data);\r\n        this.off(event, wrapper);\r\n      };\r\n      this.on(event, wrapper);\r\n    },\r\n\r\n    off(event, handler) {\r\n      if (!listeners[event]) return;\r\n      if (!handler) {\r\n        delete listeners[event];\r\n      } else {\r\n        listeners[event] = listeners[event].filter(fn => fn !== handler);\r\n      }\r\n    },\r\n\r\n    getStatus() {\r\n      return isConnected ? 'connected' : 'disconnected';\r\n    }\r\n  };\r\n}"],"names":[],"mappings":"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"}