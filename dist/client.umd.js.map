{"version":3,"file":"client.umd.js","sources":["../src/shared.js","../src/client.js"],"sourcesContent":["export function encodeMessage(event, data) {\r\n  return JSON.stringify({ event, data });\r\n}\r\n\r\nexport function decodeMessage(msg) {\r\n  try {\r\n    return JSON.parse(msg);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n","import { encodeMessage, decodeMessage } from './shared.js';\r\n\r\nexport function createClient(url, options = {}) {\r\n  const {\r\n    reconnect = true,\r\n    reconnectInterval = 2000,\r\n    maxRetries = 10,\r\n    debug = false,\r\n  } = options;\r\n\r\n  let socket;\r\n  const listeners = {};\r\n  let isConnected = false;\r\n  let retryCount = 0;\r\n\r\n  function log(...args) {\r\n    if (debug) console.log('[WebSocketClient]', ...args);\r\n  }\r\n\r\n  function connect() {\r\n    socket = new WebSocket(url);\r\n\r\n    socket.onopen = () => {\r\n      isConnected = true;\r\n      retryCount = 0;\r\n      log('Connected');\r\n      if (listeners['connect']) listeners['connect'].forEach(fn => fn());\r\n    };\r\n\r\n    socket.onmessage = (e) => {\r\n      const msg = decodeMessage(e.data);\r\n      if (msg && listeners[msg.event]) {\r\n        listeners[msg.event].forEach(fn => fn(msg.data));\r\n      }\r\n    };\r\n\r\n    socket.onerror = (err) => {\r\n      if (listeners['error']) listeners['error'].forEach(fn => fn(err));\r\n    };\r\n\r\n    socket.onclose = () => {\r\n      isConnected = false;\r\n      log('Disconnected');\r\n      if (listeners['disconnect']) listeners['disconnect'].forEach(fn => fn());\r\n      if (reconnect && retryCount < maxRetries) {\r\n        retryCount++;\r\n        setTimeout(() => connect(), reconnectInterval * retryCount);\r\n      }\r\n    };\r\n  }\r\n\r\n  connect();\r\n\r\n  return {\r\n    emit(event, data) {\r\n      if (isConnected) socket.send(encodeMessage(event, data));\r\n    },\r\n\r\n    emitWithAck(event, data, timeout = 2000) {\r\n      return new Promise((resolve, reject) => {\r\n        const id = Date.now().toString();\r\n        const ackEvent = `${event}_ack_${id}`;\r\n\r\n        const handler = (res) => {\r\n          resolve(res);\r\n          this.off(ackEvent);\r\n        };\r\n\r\n        this.on(ackEvent, handler);\r\n        this.emit(event, { ...data, _ackId: id });\r\n\r\n        setTimeout(() => {\r\n          this.off(ackEvent);\r\n          reject('Timeout');\r\n        }, timeout);\r\n      });\r\n    },\r\n\r\n    on(event, handler) {\r\n      if (!listeners[event]) listeners[event] = [];\r\n      listeners[event].push(handler);\r\n    },\r\n\r\n    once(event, handler) {\r\n      const wrapper = (data) => {\r\n        handler(data);\r\n        this.off(event, wrapper);\r\n      };\r\n      this.on(event, wrapper);\r\n    },\r\n\r\n    off(event, handler) {\r\n      if (!listeners[event]) return;\r\n      if (!handler) {\r\n        delete listeners[event];\r\n      } else {\r\n        listeners[event] = listeners[event].filter(fn => fn !== handler);\r\n      }\r\n    },\r\n\r\n    getStatus() {\r\n      return isConnected ? 'connected' : 'disconnected';\r\n    }\r\n  };\r\n}"],"names":[],"mappings":"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"}